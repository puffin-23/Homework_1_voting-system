<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система голосования</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .button { margin: 5px; padding: 10px; border: none; background-color: #4CAF50; color: white; }
        .stats { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Голосование</h1>
    <div id="variants"></div>
    <div class="stats" id="statistics"></div>

    <script>
        async function fetchVariants() {
            const response = await fetch('/variants');
            const data = await response.json();
            return data;
        }

        async function fetchStatistics() {
            const response = await fetch('/stat', {
                method: 'POST'
            });
            const stats = await response.json();
            return stats;
        }

        async function castVote(code) {
            await fetch('/vote', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code })
            });
        }

        async function render() {
            const variants = await fetchVariants();
            const stats = await fetchStatistics();

            const variantsDiv = document.getElementById('variants');
            variantsDiv.innerHTML = '';

            for (const [code, { text }] of Object.entries(variants)) {
                const button = document.createElement('button');
                button.className = 'button';
                button.textContent = text;
                button.onclick = async () => {
                    await castVote(code);
                    updateStats();
                };
                variantsDiv.appendChild(button);
            }

            updateStats(stats);
        }

        async function updateStats() {
            const stats = await fetchStatistics();
            const statsDiv = document.getElementById('statistics');
            statsDiv.innerHTML = '<h2>Статистика голосования:</h2>';
            stats.forEach(item => {
                statsDiv.innerHTML += `<p>Вариант ${item.code}: ${item.count} голосов</p>`;
            });
        }

        render();
    </script>
</body>
</html>